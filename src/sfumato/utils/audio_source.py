# generated by Gemini 3 Pro
import numpy as np
import soundfile as sf
from scipy import signal


class AudioSource:
    """
    シミュレーション用のオーディオデータを生成・読み込みするクラス
    """

    def __init__(self, sample_rate: float = 48000.0):
        self.fs = sample_rate

    def sine_tone(
        self, frequency: float, duration: float, amplitude: float = 0.8
    ) -> np.ndarray:
        """
        指定した周波数の正弦波（サイン波）を生成します。

        Args:
            frequency: 周波数 (Hz) 例: 440.0 (ラの音)
            duration: 長さ (秒)
            amplitude: 振幅 (0.0 ~ 1.0)

        Returns:
            np.ndarray: 音声データ配列 (-1.0 ~ 1.0)
        """
        t = np.arange(int(self.fs * duration)) / self.fs
        # sin(2πft)
        wave = amplitude * np.sin(2 * np.pi * frequency * t)
        return wave.astype(np.float32)

    def time_tone(
        self,
        fs: float,
    ):
        """
        時報 (Time Signal) 生成ロジック
        """
        t_short = np.arange(0, 0.1, 1 / fs)
        beep_440 = 0.5 * np.sin(2 * np.pi * 440 * t_short)

        silence = np.zeros(int(0.9 * fs))

        t_long = np.arange(0, 2.0, 1 / fs)
        beep_880 = 0.5 * np.sin(2 * np.pi * 880 * t_long)

        unit = np.concatenate([beep_440, silence])
        melody = np.concatenate([unit, unit, unit, beep_880])

        return melody
